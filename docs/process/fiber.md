在前一章讲解React16的新架构时，我们提到的**虚拟DOM**在`React`中有个正式的称呼——Fiber。在之后的学习中，我们会用`Fiber`来取代**React16虚拟DOM**这一称呼。

接下来让我们了解下`Fiber`因何而来？他的作用是什么？

## Fiber的起源

最早的`Fiber`官方解释来源于[2016年React团队成员Acdlite的一篇介绍](https://github.com/acdlite/react-fiber-architecture)。从上一章的学习我们知道：

在React15及以前，`Reconciler`采用递归的方式创建虚拟DOM，递归过程是不能中断的。如果组件树的层级很深，递归会占用线程很多时间，造成卡顿。

为了解决这个问题，React16用**异步的可中断更新**替换**递归的无法中断的更新**。如果将状态改变作为一个任务（比如调用`this.setState`），那么**可中断更新**需要满足如下条件：

- 暂停任务，并在稍后继续该任务
- 不同任务赋予不同优先级
- 复用之前已经完成的任务
- 遗弃已经不需要再执行的任务

显然曾经用于递归的**虚拟DOM**数据结构已经无法满足需要。于是，全新的`Fiber`架构应运而生。

## Fiber的结构

由于render阶段产生的结果能对应多个平台的commit，那render阶段产生的结果就不能是平台相关的。如果render阶段产生的节点都是DOM节点，显然这些节点是没法在Native环境被commit的。所以我们需要一种平台无关的节点结构。我们输入的JSX是一种描述组件结构的对象，但他没法描述哪个节点更新，哪个节点删除这样的节点行为，所以我们需要一种能够描述节点行为的结构。在讲到schedule阶段时，我们希望低优先级的schedule是可以被终止以重新开始一个更高优先级的schedule的。那么schedule的节点粒度一定要够细，这样我们才能完全操控节点终止schedule的位置并清除节点schedule产生的结果再重新开始。
